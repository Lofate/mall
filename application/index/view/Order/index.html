{extend name="IndexPublic:public"/}
{block name="title"}
    前台订单
{/block}

{block name="index"}

<!DOCTYPE html">
<!-- saved from url=(0058)http://www.17sucai.com/preview/2/2017-07-25/Gwc/index.html -->
<html>
 <head>
  <meta charset="UTF-8" /> 
  <title></title> 
  <!-- <link href="/static/orders/css/public.css" type="text/css" rel="stylesheet" />  -->
  <link rel="stylesheet" type="text/css" href="/static/orders/css/base.css" /> 
  <!-- <script type="text/javascript" src="/static/orders/js/jquery_cart.js.下载"></script>  -->
  <link rel="stylesheet" type="text/css" href="/static/orders/css/checkOut.css" /> 
 </head> 
 <!--收货地址body部分开始--> 
 <body>
  <div class="border_top_cart"> 
   <script type="text/javascript">
    var checkoutConfig={
        addressMatch:'common',
        addressMatchVarName:'data',
        hasPresales:false,
        hasBigTv:false,
        hasAir:false,
        hasScales:false,
        hasGiftcard:false,
        totalPrice:244.00,
        postage:10,//运费
        postFree:true,//活动是否免邮了
        bcPrice:150,//计算界值
        activityDiscountMoney:0.00,//活动优惠
        showCouponBox:0,
        invoice:{
            NA:"0",
            personal:"1",
            company:"2",
            electronic:"4"
        }
    };
    var miniCartDisable=true;
</script> 
   <div class="container"> 
    <div class="checkout-box"> 
     <form id="checkoutForm" action="/homeorderinfo/index" method="post">
      <input type="hidden" name="ids" value="{$ids}"> 
      <div class="checkout-box-bd"> 
       <!-- 地址状态 0：默认选择；1：新增地址；2：修改地址 --> 
       <input type="hidden" name="Checkout[addressState]" id="addrState" value="0" /> 


       <!-- 收货地址 --> 
       <div class="xm-box"> 
        <div class="box-hd "> 
         <h2 class="title">收货地址</h2> 
         <!----> 
        </div> 
        <div class="box-bd"> 
         <div class="clearfix xm-address-list" id="checkoutAddrList">
         {foreach name="data" item="row"}
          <!-- <input type="hidden" name="Checkout[addressState]" id="addrState" value="1" />  -->
          <dl class="item" type="radio" > 
          	<input type="hidden" name="id" value="{$row['id']}">
           <dt> 
            <strong class="itemConsignee">{$row['name']}</strong> 
            <span class="itemTag tag">{$row['label']}</span> 
           </dt> 
           <dd> 
            <p class="tel itemTel">{$row['phone']}</p> 
            <p class="itemRegion">{$row['province']}</p> 
            <p class="itemStreet">{$row['street']}<span>({$row['post']})</span></p> 
            <a href="/homeorders/deladds/id/{$row['id']}" class="edit-btn">删除</a>

           </dd> 
           <dd style="display:none"> 
            <input type="radio" name="Checkout[address]" class="addressId" value="10140916720030323" /> 
           </dd> 
          </dl>
          {/foreach} 

          <div class="item use-new-addr" id="J_useNewAddr" data-state="off"> 
           <span class="iconfont icon-add"><img src="/static/orders/img/add_cart.png" /></span> 使用新地址 
          </div> 
         </div> 
         <input type="hidden" name="newAddress[type]" id="newType" value="common" /> 
         <input type="hidden" name="newAddress[consignee]" id="newConsignee" /> 
         <input type="hidden" name="newAddress[province]" id="newProvince" /> 
         <input type="hidden" name="newAddress[city]" id="newCity" /> 
         <input type="hidden" name="newAddress[district]" id="newCounty" /> 
         <input type="hidden" name="newAddress[address]" id="newStreet" /> 
         <input type="hidden" name="newAddress[zipcode]" id="newZipcode" /> 
         <input type="hidden" name="newAddress[tel]" id="newTel" /> 
         <input type="hidden" name="newAddress[tag_name]" id="newTag" /> 











         <!--点击弹出新增/收货地址界面start--> 
         <div class="xm-edit-addr-box" id="J_editAddrBox">

          <div class="bd"> 
           <div class="item"> 
            <label>收货人姓名<span>*</span></label> 
            <input type="text" name="userAddress[consignee]" id="Consignee" class="input" placeholder="收货人姓名(最小值为2位中文字)" maxlength="15" autocomplete="off" /> 
            <p class="tip-msg tipMsg"></p> 
           </div> 
           <div class="item"> 
            <label>联系电话<span>*</span></label> 
            <input type="text" name="userAddress[tel]" class="input" id="Telephone" placeholder="11位手机号" autocomplete="off" /> 
            <p class="tel-modify-tip" id="telModifyTip"></p> 
            <p class="tip-msg tipMsg"></p> 
           </div> 
           <div class="item"> 
            <label>地址<span>*</span></label> 
            <select name="userAddress[province]" id="Provinces" class="select-1"><option value="0">省份/自治区</option><option zipcode="0" value="2">北京</option><option zipcode="0" value="3">天津</option><option zipcode="0" value="4">河北</option><option zipcode="0" value="5">山西</option><option zipcode="0" value="6">内蒙古</option><option zipcode="0" value="7">辽宁</option><option zipcode="0" value="8">吉林</option><option zipcode="0" value="9">黑龙江</option><option zipcode="0" value="10">上海</option><option zipcode="0" value="11">江苏</option><option zipcode="0" value="12">浙江</option><option zipcode="0" value="13">安徽</option><option zipcode="0" value="14">福建</option><option zipcode="0" value="15">江西</option><option zipcode="0" value="16">山东</option><option zipcode="0" value="17">河南</option><option zipcode="0" value="18">湖北</option><option zipcode="0" value="19">湖南</option><option zipcode="0" value="20">广东</option><option zipcode="0" value="21">广西</option><option zipcode="0" value="22">海南</option><option zipcode="0" value="23">重庆</option><option zipcode="0" value="24">四川</option><option zipcode="0" value="25">贵州</option><option zipcode="0" value="26">云南</option><option zipcode="0" value="27">西藏</option><option zipcode="0" value="28">陕西</option><option zipcode="0" value="29">甘肃</option><option zipcode="0" value="30">青海</option><option zipcode="0" value="31">宁夏</option><option zipcode="0" value="32">新疆</option></select> 
            <select name="userAddress[city]" id="Citys" class="select-2" disabled=""> <option>城市/地区/自治州</option> </select> 
            <select name="userAddress[county]" id="Countys" class="select-3" disabled=""> <option>区/县</option> </select> 
            <textarea name="userAddress[street]" class="input-area" id="Street" placeholder="路名或街道地址，门牌号(5-32字)"></textarea> 
            <p class="tip-msg tipMsg"></p> 
           </div> 
           <div class="item"> 
            <label>邮政编码<span>*</span></label> 
            <input type="text" name="userAddress[zipcode]" id="Zipcode" class="input" placeholder="6位邮政编码" autocomplete="off" /> 
            <p class="zipcode-tip" id="zipcodeTip"></p> 
            <p class="tip-msg tipMsg"></p> 
           </div> 
           <div class="item"> 
            <label>地址标签<span>*</span></label> 
            <input type="text" name="userAddress[tag]" id="Tag" class="input" placeholder="地址标签：如&quot;家&quot;、&quot;公司&quot;。限5个字内" /> 
            <p class="tip-msg tipMsg"></p> 
           </div> 
          </div> 
          <div class="ft clearfix"> 
           <button type="button" class="btn btn-lineDake btn-small " id="J_editAddrCancel">取消</button>
           <button type="button" class="btn btn-primary  btn-small" id="J_editAddrOk">保存</button>
          </div>

         </div> 
         <!--点击弹出新增/收货地址界面end-->





         <div class="xm-edit-addr-backdrop" id="J_editAddrBackdrop"></div> 
        </div> 
       </div> 
       <!-- 收货地址 END--> 



       <div id="checkoutPayment"> 
        <!-- 支付方式 --> 
        <div class="xm-box"> 
         <div class="box-hd "> 
          <h2 class="title">支付方式</h2> 
         </div> 
         <div class="box-bd"> 
          <ul id="checkoutPaymentList" class="checkout-option-list clearfix J_optionList"> 
           <li class="item selected"> <input type="radio" name="Checkout[pay_id]" checked="checked" value="1" /> <p> 在线支付 <span></span> </p> </li> 
           
          </ul> 
         </div> 
        </div> 
        <!-- 支付方式 END--> 
        <div class="xm-box"> 
         <div class="box-hd "> 
          <h2 class="title">配送方式</h2> 
         </div> 
         <div class="box-bd"> 
          <ul id="checkoutShipmentList" class="checkout-option-list clearfix J_optionList"> 
           <li class="item selected"> <input type="radio" data-price="0" name="Checkout[shipment_id]" checked="checked" value="1" /> <p> 快递配送（免运费） <span></span> </p> </li> 
          </ul> 
         </div> 
        </div> 
        <!-- 配送方式 END--> 
        <!-- 配送方式 END--> 
       </div> 
       <!-- 送货时间 --> 
       <div class="xm-box"> 
        <div class="box-hd"> 
         <h2 class="title">送货时间</h2> 
        </div> 
        <div class="box-bd"> 
         <ul class="checkout-option-list clearfix J_optionList"> 
          <li class="item selected"><input type="radio" checked="checked" name="Checkout[best_time]" value="1" /><p>不限送货时间<span>周一至周日</span></p></li>
          <li class="item "><input type="radio" name="Checkout[best_time]" value="2" /><p>工作日送货<span>周一至周五</span></p></li>
          <li class="item "><input type="radio" name="Checkout[best_time]" value="3" /><p>双休日、假日送货<span>周六至周日</span></p></li> 
         </ul> 
        </div> 
       </div> 
       <!-- 送货时间 END--> 
       <!-- 发票信息 --> 
       <div id="checkoutInvoice"> 
        <div class="xm-box"> 
         <div class="box-hd"> 
          <h2 class="title">发票信息</h2> 
         </div> 
         <div class="box-bd"> 
          <ul class="checkout-option-list checkout-option-invoice clearfix J_optionList J_optionInvoice"> 
           <li class="hide"> 电子个人发票4 </li> 
           <li class="item selected"> 
            <!--<label><input type="radio"  class="needInvoice" value="0" name="Checkout[invoice]">不开发票</label>--> <input type="radio" checked="checked" value="4" name="Checkout[invoice]" /> <p>电子发票（非纸质）</p> </li> 
           <li class="item "> <input type="radio" value="1" name="Checkout[invoice]" /> <p>普通发票（纸质）</p> </li> 
          </ul> 
          <p id="eInvoiceTip" class="e-invoice-tip "> 电子发票是税务局认可的有效凭证，可作为售后维权凭据，不随商品寄送。开票后不可更换纸质发票，如需报销请选择普通发票。<a href="" target="_blank">什么是电子发票？</a> </p> 
          <div class="invoice-info nvoice-info-1" id="checkoutInvoiceElectronic" style="display:none;"> 
           <p class="tip">电子发票目前仅对个人用户开具，不可用于单位报销 ，不随商品寄送</p> 
           <p>发票内容：购买商品明细</p> 
           <p>发票抬头：个人</p> 
           <p> <span class="hide"><input type="radio" value="4" name="Checkout[invoice_type]" checked="checked" id="electronicPersonal" class="invoiceType" /></span> </p>
           <dl> 
            <dt>
             什么是电子发票?
            </dt> 
            <dd>
             · 电子发票是纸质发票的映像，是税务局认可的有效凭证，与传统纸质发票具有同等法律效力，可作为售后维权凭据。
            </dd> 
            <dd>
             · 开具电子服务于个人，开票后不可更换纸质发票，不可用于单位报销。
            </dd> 
            <dd>
             · 您在订单详情的&quot;发票信息&quot;栏可查看、下载您的电子发票。
             <a href="http://bbs.xiaomi.cn/thread-9285999-1-1.html" target="_blank">什么是电子发票？</a>
            </dd> 
           </dl> 
           <p></p> 
          </div> 
          <div class="invoice-info invoice-info-2" id="checkoutInvoiceDetail" style="display:none;"> 
           <p>发票内容：购买商品明细</p> 
           <p> 发票抬头：请确认单位名称正确,以免因名称错误耽搁您的报销。注：合约机话费仅能开个人发票 </p> 
           <ul class="type clearfix J_invoiceType"> 
            <li class="hide"> <input type="radio" value="0" name="Checkout[invoice_type]" id="noNeedInvoice" /> </li> 
            <li class=""> <input class="invoiceType" type="radio" id="commonPersonal" name="Checkout[invoice_type]" value="1" /> 个人 </li> 
            <li class=""> <input class="invoiceType" type="radio" name="Checkout[invoice_type]" value="2" /> 单位 </li> 
           </ul> 
           <div id="CheckoutInvoiceTitle" class=" hide  invoice-title"> 
            <label for="Checkout[invoice_title]">单位名称：</label> 
            <input name="Checkout[invoice_title]" type="text" maxlength="49" value="" class="input" /> 
            <span class="tip-msg J_tipMsg"></span> 
           </div> 
          </div> 
         </div> 
        </div> 
       </div> 
       <!-- 发票信息 END--> 
      </div> 
      <div class="checkout-box-ft"> 
       <!-- 商品清单 --> 
       <div id="checkoutGoodsList" class="checkout-goods-box"> 
        <div class="xm-box"> 
         <div class="box-hd"> 
          <h2 class="title">确认订单信息</h2> 
         </div> 
         <div class="box-bd"> 
          <dl class="checkout-goods-list"> 
           <dt class="clearfix"> 
            <span class="col col-1">商品名称</span> 
            <span class="col col-2">购买价格</span> 
            <span class="col col-3">购买数量</span> 
            <span class="col col-4">小计（元）</span> 
           </dt>
           {foreach name="data2" item="val"} 
           <dd class="item clearfix"> 
            <div class="item-row"> 
             <div class="col col-1"> 
              <div class="g-pic"> 
               <img src="{$val['pic']}" width="40" height="40" /> 
              </div> 
              <div class="g-info"> 
               <a href="javascript:;"> {$val['name']} </a> 
              </div> 
             </div> 
             <div class="col col-2">
              {$val['price']}元
             </div> 
             <div class="col col-3">
              {$val['num']}
             </div> 
             <div class="col col-4">
              {$val['price']*$val['num']}元
             </div> 
            </div> 
           </dd> 
            {/foreach}
          </dl> 
          <div class="checkout-count clearfix"> 
           <div class="checkout-count-extend xm-add-buy"> 
            <h3 class="title">会员留言</h3>
            <br /> 
            <textarea rows="10" cols="80" maxlength="200" placeholder="少于200字"> </textarea>
           </div> 
           <!-- checkout-count-extend --> 
           <div class="checkout-price"> 
            <ul> 
             <li> 订单总额：<span>{$total}元</span> </li> 
             <li> 活动优惠：<span>-0元</span> <script type="text/javascript">
                                            checkoutConfig.activityDiscountMoney=0;
                                            checkoutConfig.totalPrice=244.00;
                                        </script> </li> 
             <li> 优惠券抵扣：<span id="couponDesc">-0元</span> </li> 
             <li> 运费：<span id="postageDesc">0元</span> </li> 
            </ul> 
            <p class="checkout-total">应付总额：<span><strong>{$total}.00</strong>元</span></p> 
            <input type="hidden" name="total" value="{$total}">
           </div> 
           <!--  --> 
          </div> 
         </div> 
        </div> 
        <!--S 加价购 产品选择弹框 --> 
        <div class="modal hide modal-choose-pro" id="J_choosePro-664"> 
         <div class="modal-header"> 
          <span class="close" data-dismiss="modal"><i class="iconfont"></i></span> 
          <h3>选择产品</h3> 
          <div class="more"> 
           <div class="xm-recommend-page clearfix"> 
            <a class="page-btn-prev   J_carouselPrev iconfont" href="javascript: void(0);"></a>
            <a class="page-btn-next  J_carouselNext iconfont" href="javascript: void(0);"></a> 
           </div> 
          </div> 
         </div> 
         <div class="modal-body J_chooseProCarousel"> 
          <div class="J_carouselWrap modal-choose-pro-list-wrap"> 
           <ul class="clearfix J_carouselList"> 
           </ul> 
          </div> 
         </div> 
         <div class="modal-footer"> 
          <a href="" class="btn btn-disabled J_chooseProBtn">加入购物车</a> 
         </div> 
        </div> 
        <!--E 加价购 产品选择弹框 --> 
        <!--S 保障计划 产品选择弹框 --> 
       </div> 
       <!-- 商品清单 END --> 
       <input type="hidden" id="couponType" name="Checkout[couponsType]" /> 
       <input type="hidden" id="couponValue" name="Checkout[couponsValue]" /> 
       <div class="checkout-confirm"> 
        <a href="/homecarts/index">返回购物车</a> 
        <input type="submit" class="btn btn-primary" value="立即下单" id="checkoutToPay" /> 
       </div> 
      </div> 
     </form>
    </div> 
   </div> 
   <!-- 禮品卡提示 S--> 
   <div class="modal hide lipin-modal" id="lipinTip"> 
    <div class="modal-header"> 
     <h2 class="title">温馨提示</h2> 
     <p> 为保障您的利益与安全，下单后礼品卡将会被使用，<br /> 且订单信息将不可修改。请确认收货信息：</p> 
    </div> 
    <div class="modal-body"> 
     <ul> 
      <li><strong>收&nbsp;&nbsp;货&nbsp;&nbsp;人：</strong><span id="lipin-uname"></span></li> 
      <li><strong>联系电话：</strong><span id="lipin-uphone"></span></li> 
      <li><strong>收货地址：</strong><span id="lipin-uaddr"></span></li> 
     </ul> 
    </div> 
    <div class="modal-footer"> 
     <span class="btn btn-primary" id="useGiftCard">确认下单</span>
     <span class="btn btn-dakeLight" id="closeGiftCard">返回修改</span> 
    </div> 
   </div> 
   <!--  禮品卡提示 E--> 
   <!-- 预售提示 S--> 
   <div class="modal hide yushou-modal" id="yushouTip"> 
    <div class="modal-body"> 
     <h2>请确认收货地址及发货时间</h2> 
     <ul class="list"> 
      <li> <strong>请确认配送地址，提交后不可变更：</strong> <p id="yushouAddr"> </p> <span class="icon-common icon-1"></span> </li> 
      <li> <strong>支付后发货</strong> <p>如您随预售商品一起购买的商品，将与预售商品一起发货</p> <span class="icon-common icon-2"></span> </li> 
      <li> <strong>以支付价格为准</strong> <p>如预售产品发生调价，已支付订单价格将不受影响。</p> <span class="icon-common icon-3"></span> </li> 
     </ul> 
    </div> 
    <div class="modal-footer"> 
     <p id="yushouOk" class="yushou-ok"> <span class="icon-checkbox"><i class="iconfont"></i></span> 我已确认收货地址正确，不再变更</p> 
     <span class="btn btn-lineDakeLight" data-dismiss="modal">返回修改地址</span> 
     <span class="btn btn-primary" id="yushouCheckout">继续下单</span> 
    </div> 
   </div> 
   <!--  预售提示 E--> 
   <script id="newAddrTemplate" type="text/x-dot-template">
        <dl class="item selected" data-isnew="true" data-consignee="{{=it.consignee}}" data-tel="{{=it.tel}}" data-province="{{=it.province}}" data-provincename="{{=it.provinceName}}" data-city="{{=it.city}}" data-cityname="{{=it.cityName}}" data-county="{{=it.county}}" data-countyname="{{=it.countyName}}" data-zipcode="{{=it.zipcode}}" data-street="{{=it.street}}" data-tag="{{=it.tag}}">
            <dt>
                <strong class="itemConsignee">{{=it.consignee}}</strong>
                {{? it.tag }}
                    <span  class="itemTag tag">{{=it.tag}}</span>
                {{?}}
            </dt>
            <dd>
                <p class="tel itemTel">{{=it.tel}}</p>
                <p  class="itemRegion">{{=it.provinceName}} {{=it.cityName}} {{=it.countyName}}</p>
                <p  class="itemStreet">{{=it.street}} ({{=it.zipcode}})</p>
                <span class="edit-btn J_editAddr">编辑</span>
            </dd>
        </dl>
</script> 
   <!-- 保险弹窗 --> 
   <!-- 保险弹窗 --> 
   <script src="/static/orders/js/base.min.js.下载"></script> 
   <script type="text/javascript" src="/static/orders/js/address_all.js.下载"></script> 
   <script type="text/javascript" src="/static/orders/js/checkout.min.js.下载"></script> 
  </div> 
  <!--收货地址body部分结束--> 
 </body>
  <script type="text/javascript">

    //添加新地址
    $("#J_editAddrOk").click(function(){
      var name=$("#J_editAddrBox").find("input[name='userAddress[consignee]']").val();
      var phone=$("#J_editAddrBox").find("input[name='userAddress[tel]']").val();
      var pro=$("#Provinces").find("option:selected").html();//省
      var city=$("#Citys").find("option:selected").html();//市
      var county=$("#Countys").find("option:selected").html();//区
      var street=$("#Street").val();
      var label=$("#Tag").val();
      var post=$("#Zipcode").val();

      $.ajaxSettings.async=false;
      // alert(street);
      $.post("/homeorders/insert",{name:name,phone:phone,pro:pro,city:city,county:county,street:street,label:label,post:post},function(data){
        if(data==1){
          alert("添加成功");
        }else{
          alert("添加失败");
        }
      });
      
    });

    // 修改已有地址
    // $(".J_editAddr").click(function(){
    //   var id=$(this).parents("dl").prev().val();
    //   $.get("/homeorders/check",{id:id},function(data1){
    //     if(data1){
    //       $("J_editAddrOk").click(function(){
    //           var name=$("#J_editAddrBox").find("input[name='userAddress[consignee]']").val();
    //           var phone=$("#J_editAddrBox").find("input[name='userAddress[tel]']").val();
    //           var pro=$("#Provinces").find("option:selected").html();//省
    //           var city=$("#Citys").find("option:selected").html();//市
    //           var county=$("#Countys").find("option:selected").html();//区
    //           var street=$("#Street").val();
    //           var label=$("#Tag").val();
    //           var post=$("#Zipcode").val();

    //           $.post("/homeorders/update",{id:id,name:name,phone:phone,pro:pro,city:city,county:county,street:street,label:label,post:post},function(data){
    //             if(data){
    //               alert("修改成功");
    //             }else{
    //               alert("修改失败");
    //             }
    //           });
    //       });
           
    //     }
    //   });
    // });
    // 
    

    // $(".del").click(function(){
    //   var o=$(this);
    //   var id=$(this).parents("dl").prev().val();
    //   $.get("/homeorders/deladds",{id:id},function(data){
    //     if(data){
    //       o.parents("dl").remove();
    //       alert("删除成功");
    //     }else{
    //       alert("删除失败");
    //     }
    //   });
    // });
  </script>
</html>

{/block}